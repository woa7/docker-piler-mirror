#
# minimal sphinx configuration suited to piler
#

source base
{
   type = mysql
   sql_host = MYSQL_HOSTNAME
   sql_db = MYSQL_DATABASE
   sql_user = MYSQL_USERNAME
   sql_pass = MYSQL_PASSWORD

   sql_attr_uint = size
   sql_attr_uint = sent
   sql_attr_uint = attachments
}

source tag : base
{
   sql_query_pre = SET NAMES utf8mb4
   sql_query  = SELECT `_id`, `id` AS iid, `uid`, `tag` FROM `tag`

   sql_attr_uint = iid
   sql_attr_uint = uid

}

source note : base
{
   sql_query_pre = SET NAMES utf8mb4
   sql_query  = SELECT `_id`, `id` AS iid, `uid`, `note` FROM `note`

   sql_attr_uint = iid
   sql_attr_uint = uid

}

index tag1
{
        source                  = tag
        path                    = LOCALSTATEDIR/piler/sphinx/tag1
        docinfo                 = extern
	dict			= keywords
        min_prefix_len          = 5
        min_word_len            = 1
        #ngram_len               = 1
        #ngram_chars             = U+3000..U+2FA1F
}


index note1
{
        source                  = note
        path                    = LOCALSTATEDIR/piler/sphinx/note1
        docinfo                 = extern
	dict			= keywords
        min_prefix_len          = 5
        min_word_len            = 1
        #ngram_len               = 1
        #ngram_chars             = U+3000..U+2FA1F
}


index rt1
{
        type = rt
        path = /var/piler/sphinx/rt1
        rt_mem_limit = 512M

        rt_field = sender
        rt_field = fromdomain
        rt_field = to
        rt_field = todomain
        rt_field = subject
        rt_field = body
        rt_field = attachment_types

        rt_attr_uint = size
        rt_attr_uint = direction
        rt_attr_uint = attachments

        rt_attr_timestamp = sent
}


indexer
{
	mem_limit		= 256M
}


searchd
{
	listen			= 127.0.0.1:9312
	listen			= 127.0.0.1:9306:mysql41
	log			= /dev/null
	binlog_path             = /var/piler/sphinx
        binlog_flush            = 2
        binlog_max_log_size     = 64M
	##query_log		=
	read_timeout		= 5
	max_children		= 30
	pid_file		= /var/run/piler/searchd.pid
	seamless_rotate		= 1
	preopen_indexes		= 1
	unlink_old		= 1
	thread_stack		= 512k
	workers			= threads # for RT to work
}
